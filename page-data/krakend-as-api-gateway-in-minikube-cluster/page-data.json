{"componentChunkName":"component---src-templates-blog-post-js","path":"/krakend-as-api-gateway-in-minikube-cluster","result":{"data":{"markdownRemark":{"html":"<p>In this post I want to describe how to setup a local Minikube environment with an API Gateway solution called <a href=\"https://www.krakend.io\">KrakenD</a>. An API Gateway acts as a reverse proxy and ingress for your cluster containing all further backend services. It can handle rate limiting, authentication, data aggregation and/or manipulation and many more. KrakenD is a fast solution to create such a gateway by using simple JSON configuration.</p>\n<p>A <a href=\"https://kubernetes.io/docs/concepts/services-networking/service/#loadbalancer\">Kubernetes LoadBalancer</a> is a special type of Kubernetes service which directs traffic from external sources to the internal backend pods. So that is the kind of thing we want to combine with the krakenD API Gateway.</p>\n<p>The prerequisites for this adventure are</p>\n<ul>\n<li><code>docker</code> installed</li>\n<li><code>kubectl</code> installed</li>\n<li><code>minikube</code> installed</li>\n</ul>\n<p>Let‚Äôs begin by starting the Minikube cluster</p>\n<pre class=\"grvsc-container ayu-light grvsc-mm-tJFxWe\" data-language=\"sh\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">minikube start</span></span></code></pre>\n<p>This command creates the cluster and should end with</p>\n<pre class=\"grvsc-container ayu-light grvsc-mm-tJFxWe\" data-language=\"sh\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">üèÑ  Done</span><span class=\"grvsc-tmH3wB-12 grvsc-tJFxWe-12\">!</span></span></code></pre>\n<p>To get the <code>LoadBalancer</code> up and running we need a KrakenD image first. This is really simple, because all KrakenD needs is a simple configuration file. By taking the provided base image it is nothing else than</p>\n<pre class=\"grvsc-container ayu-light grvsc-mm-tJFxWe\" data-language=\"dockerfile\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-3 grvsc-tmH3wB-i grvsc-tJFxWe-3 grvsc-tJFxWe-i\"># Dockerfile</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-6 grvsc-tJFxWe-6\">FROM</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> devopsfaith/krakend</span></span>\n<span class=\"grvsc-line\"></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-6 grvsc-tJFxWe-6\">ADD</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> ./krakend.json /etc/krakend/krakend.json</span></span>\n<span class=\"grvsc-line\"></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-6 grvsc-tJFxWe-6\">EXPOSE</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> 8080</span></span></code></pre>\n<p>To improve this a next step could be to put this configuration into a Kubernetes <code>ConfigMap</code> but let us start here.</p>\n<p>Create the most basic <em>krakend.json</em> with the content</p>\n<pre class=\"grvsc-container ayu-light grvsc-mm-tJFxWe\" data-language=\"json\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">{</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">\t</span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">&quot;version&quot;</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-5 grvsc-tJFxWe-5\">2</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">}</span></span></code></pre>\n<p>in the same directory like the <em>Dockerfile</em>. To push the image into the local directory used by the Minikube cluster execute</p>\n<pre class=\"grvsc-container ayu-light grvsc-mm-tJFxWe\" data-language=\"sh\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-13 grvsc-tJFxWe-13\">eval</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">$(minikube docker-env)</span></span></code></pre>\n<p>And continue building the image within the same terminal session with</p>\n<pre class=\"grvsc-container ayu-light grvsc-mm-tJFxWe\" data-language=\"sh\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">docker build </span><span class=\"grvsc-tmH3wB-13 grvsc-tJFxWe-13\">.</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> -t krakend-api-gateway</span></span></code></pre>\n<p>To deploy this into the Kubernetes cluster I use the following definition.</p>\n<pre class=\"grvsc-container ayu-light grvsc-mm-tJFxWe\" data-language=\"yaml\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-3 grvsc-tmH3wB-i grvsc-tJFxWe-3 grvsc-tJFxWe-i\"># k8s.yml</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">apiVersion</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">v1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">kind</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">Service</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">metadata</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">  </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">name</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">api-gateway</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">spec</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">  </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">type</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">LoadBalancer</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">  </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">selector</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">    </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">app</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">krakenD</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">  </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">ports</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">    - </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">protocol</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">TCP</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">      </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">port</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-5 grvsc-tJFxWe-5\">80</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">      </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">targetPort</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-5 grvsc-tJFxWe-5\">8080</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">---</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">apiVersion</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">apps/v1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">kind</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">Deployment</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">metadata</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">  </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">name</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">krakend-deployment</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">  </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">labels</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">    </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">app</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">krakend-api-gateway</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">spec</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">  </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">replicas</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-5 grvsc-tJFxWe-5\">1</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">  </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">selector</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">    </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">matchLabels</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">      </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">app</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">krakenD</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">  </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">template</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">    </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">metadata</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">      </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">labels</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">        </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">app</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">krakenD</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">    </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">spec</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">      </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">containers</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">        - </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">name</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">api-gateway</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">          </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">image</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">krakend-api-gateway</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">          </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">ports</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">            - </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">containerPort</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-5 grvsc-tJFxWe-5\">8080</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">          </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">imagePullPolicy</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">Never</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">          </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">command</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> [</span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">&quot;/usr/bin/krakend&quot;</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">          </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">args</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> [</span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">&quot;run&quot;</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">,</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">&quot;-d&quot;</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">,</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">&quot;-c&quot;</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">,</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">&quot;/etc/krakend/krakend.json&quot;</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">,</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">&quot;-p&quot;</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">,</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">&quot;8080&quot;</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">]</span></span></code></pre>\n<p>Here the service definition includes the <code>type: LoadBalancer</code>. This makes the service a <code>LoadBalancer</code> one which should handle external traffic.</p>\n<p>To get this into the Minikube cluster it takes nothing more than</p>\n<pre class=\"grvsc-container ayu-light grvsc-mm-tJFxWe\" data-language=\"sh\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">kubectl apply -f k8s.yml</span></span></code></pre>\n<p>This creates the <code>LoadBalancer</code> Kubernetes service and deploys one replica of the KrakenD image containing our configuration.</p>\n<p>Let‚Äôs assume there is a second service running in the cluster which contains a web service with a <code>/hello-world</code> route. And let‚Äôs assume the service is called <code>hello-world-service</code>. We now want to connect our api-gateway to direct incoming traffic to that route via the external <code>/hello-gateway</code> route.</p>\n<p>This is now done in the <em>krakend.json</em> configuration file and is basically as simple as</p>\n<pre class=\"grvsc-container ayu-light grvsc-mm-tJFxWe\" data-language=\"json\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">{</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">  </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">&quot;version&quot;</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-5 grvsc-tJFxWe-5\">2</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">  </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">&quot;timeout&quot;</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">&quot;3000ms&quot;</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">  </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">&quot;cache_ttl&quot;</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">&quot;300s&quot;</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">  </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">&quot;name&quot;</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">&quot;API - Gateway&quot;</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">  </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">&quot;endpoints&quot;</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> [</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">    {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">      </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">&quot;endpoint&quot;</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">&quot;/hello-gateway&quot;</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">      </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">&quot;output_encoding&quot;</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">&quot;string&quot;</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">      </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">&quot;method&quot;</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">&quot;GET&quot;</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">      </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">&quot;backend&quot;</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> [</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">        {</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">          </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">&quot;url_pattern&quot;</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">&quot;/hello-world&quot;</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">          </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">&quot;encoding&quot;</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">&quot;string&quot;</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">          </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">&quot;sd&quot;</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">&quot;dns&quot;</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">          </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">&quot;method&quot;</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">&quot;GET&quot;</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">          </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">&quot;host&quot;</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> [</span><span class=\"grvsc-tmH3wB-7 grvsc-tJFxWe-7\">&quot;hello-world-service&quot;</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">]</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">,</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">          </span><span class=\"grvsc-tmH3wB-10 grvsc-tJFxWe-10\">&quot;disable_host_sanitize&quot;</span><span class=\"grvsc-tmH3wB-23 grvsc-tJFxWe-23\">:</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\"> </span><span class=\"grvsc-tmH3wB-5 grvsc-tJFxWe-5\">true</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">        }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">      ]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">    }</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">  ]</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">}</span></span></code></pre>\n<p>By setting <code>‚Äúsd‚Äú: ‚Äûdns‚Äú</code> we tell KrakenD, that it should resolve the <code>‚Äúhost‚Äú:‚Äúhello-world-service‚Äú</code> by the given DNS. It‚Äôs also crucial to use <code>\"disable_host_sanitize\": true</code> while working with a service discovery in KrakenD. Nevertheless this makes the configuration rather convenient.</p>\n<p>If <code>kubectl get svc</code> gives you the following</p>\n<pre class=\"grvsc-container ayu-light grvsc-mm-tJFxWe\" data-language=\"sh\" data-index=\"9\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">‚ûú kubectl get svc</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">NAME                  TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">api-gateway           LoadBalancer   10.110.59.77    </span><span class=\"grvsc-tmH3wB-12 grvsc-tJFxWe-12\">&lt;</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">pending</span><span class=\"grvsc-tmH3wB-12 grvsc-tJFxWe-12\">&gt;</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">     80:31299/TCP   18m</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">hello-world-service   ClusterIP      10.107.30.157   </span><span class=\"grvsc-tmH3wB-12 grvsc-tJFxWe-12\">&lt;</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">none</span><span class=\"grvsc-tmH3wB-12 grvsc-tJFxWe-12\">&gt;</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">        8080/TCP       4s</span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">kubernetes            ClusterIP      10.96.0.1       </span><span class=\"grvsc-tmH3wB-12 grvsc-tJFxWe-12\">&lt;</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">none</span><span class=\"grvsc-tmH3wB-12 grvsc-tJFxWe-12\">&gt;</span><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">        443/TCP        34m</span></span></code></pre>\n<p>there is only one last step missing. The last step transform the <code>EXTERNAL-IP: &#x3C;pending></code> into our localhost ip. It is</p>\n<pre class=\"grvsc-container ayu-light grvsc-mm-tJFxWe\" data-language=\"sh\" data-index=\"10\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-tmH3wB-1 grvsc-tJFxWe-1\">minikube tunnel</span></span></code></pre>\n<p>When you execute <code>kubectl get svc</code>, you should see <code>EXTERNAL-IP: 127.0.0.1</code> for the <em>api-gateway</em></p>\n<p>üéâ By open <code>http://localhost/hello-gateway</code> you should get something like\n<figure class=\"gatsby-resp-image-figure\" style=\"margin: 15px 0;text-align:center;width:100%;\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 686px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/84d4d1322450578de2418b6a2cdd69c2/f6386/result.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.79032258064517%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABn0lEQVQoz2NwyYpgsA90ZeXRdOLXU3DiMzTW47OwtOKzsbHlc3Bw4LOztwdjN3d3Pm0dXT4lZRU+F1dXPmdnFz5bO3s+e3sHPhcXV353NzfWiMgoBoa+8gkM2pr67S7Wxs9N7IxuGptZ3zEwNr2jZ2hyR0ff6I6ugTEYa+ro3zGztLljZWN/R0vX4I62niFM7iZQ3QsNbd3q+LQcBhBgjoqM2VJelPc/pyj7f05e4f/M7Nz/GVk5YDo9MxtMFxSV/C+rqPpfWV0LZhcWl/4vKimD07FxCcsYoID17LmzG37/+fv/x/efv379+vn3x48ff3/+/PH39+/fYDZI7P///7jwLyD+f/78+cVAs5jABl68eHHjfwj48x8H+Pv3L1b8BwhA8idOnFgCNxBo+gawaX/+/Abiv9gwLgCU+wU1EOHCq1evbvtPITh37twKmIEsmzZtmn7r1q0PV65ceQY0/AUpGKQHpHfNmjXdMAOZgVgViN2B2AuIPaE0MRim1g2IlcAGamtrM/j5+TGCOIyMjExQW0jEjExBgUGMGhoaDABubq4yl2NL1QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"result\"\n        title=\"result\"\n        src=\"/static/84d4d1322450578de2418b6a2cdd69c2/f6386/result.png\"\n        srcset=\"/static/84d4d1322450578de2418b6a2cdd69c2/544ba/result.png 248w,\n/static/84d4d1322450578de2418b6a2cdd69c2/bb630/result.png 496w,\n/static/84d4d1322450578de2418b6a2cdd69c2/f6386/result.png 686w\"\n        sizes=\"(max-width: 686px) 100vw, 686px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n  }\n  \n  .grvsc-code {\n    display: inline-block;\n    min-width: 100%;\n  }\n  \n  .grvsc-line {\n    display: inline-block;\n    box-sizing: border-box;\n    width: 100%;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-line-highlighted {\n    background-color: var(--grvsc-line-highlighted-background-color, transparent);\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, transparent);\n  }\n  \n</style></figcaption>\n  </figure></p>\n<p><strong>Quick Note</strong></p>\n<p>It‚Äôs also rather easy adding e.g. authentication via <a href=\"https://auth0.com\">Auth0</a> by following the given <a href=\"https://www.krakend.io/docs/authorization/auth0/\">provided description</a>.</p>\n<h2>Link Collection</h2>\n<ul>\n<li><a href=\"https://kubernetes.io\">Kubernetes</a></li>\n<li><a href=\"https://www.krakend.io\">KrakenD - Open source API Gateway</a></li>\n<li><a href=\"https://minikube.sigs.k8s.io/docs/\">minikube</a></li>\n</ul>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n  }\n  \n  .grvsc-code {\n    display: inline-block;\n    min-width: 100%;\n  }\n  \n  .grvsc-line {\n    display: inline-block;\n    box-sizing: border-box;\n    width: 100%;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-line-highlighted {\n    background-color: var(--grvsc-line-highlighted-background-color, transparent);\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, transparent);\n  }\n  \n  .ayu-light {\n    background-color: #fafafa;\n    color: #6c7680;\n  }\n  .ayu-light .grvsc-tmH3wB-i { font-style: italic; }\n  .ayu-light .grvsc-tmH3wB-1 { color: #6C7680; }\n  .ayu-light .grvsc-tmH3wB-12 { color: #ED9366; }\n  .ayu-light .grvsc-tmH3wB-3 { color: #ABB0B6; }\n  .ayu-light .grvsc-tmH3wB-6 { color: #FA8D3E; }\n  .ayu-light .grvsc-tmH3wB-10 { color: #55B4D4; }\n  .ayu-light .grvsc-tmH3wB-23 { color: #6C7680B3; }\n  .ayu-light .grvsc-tmH3wB-5 { color: #FF9940; }\n  .ayu-light .grvsc-tmH3wB-13 { color: #F07171; }\n  .ayu-light .grvsc-tmH3wB-7 { color: #86B300; }\n  \n  /* Ayu Dark */\n  @media (prefers-color-scheme: dark) {\n    .grvsc-mm-tJFxWe {\n      background-color: #0a0e14;\n      color: #b3b1ad;\n    }\n    .grvsc-mm-tJFxWe .grvsc-tJFxWe-i { font-style: italic; }\n    .grvsc-mm-tJFxWe .grvsc-tJFxWe-1 { color: #B3B1AD; }\n    .grvsc-mm-tJFxWe .grvsc-tJFxWe-12 { color: #F29668; }\n    .grvsc-mm-tJFxWe .grvsc-tJFxWe-3 { color: #626A73; }\n    .grvsc-mm-tJFxWe .grvsc-tJFxWe-6 { color: #FF8F40; }\n    .grvsc-mm-tJFxWe .grvsc-tJFxWe-10 { color: #39BAE6; }\n    .grvsc-mm-tJFxWe .grvsc-tJFxWe-23 { color: #B3B1ADB3; }\n    .grvsc-mm-tJFxWe .grvsc-tJFxWe-5 { color: #E6B450; }\n    .grvsc-mm-tJFxWe .grvsc-tJFxWe-13 { color: #F07178; }\n    .grvsc-mm-tJFxWe .grvsc-tJFxWe-7 { color: #C2D94C; }\n  }\n</style>","frontmatter":{"title":"Deploy KrakenD as API Gateway in a Minikube Cluster","slug":"krakend-as-api-gateway-in-minikube-cluster"}},"allCommentsYaml":{"edges":[]}},"pageContext":{"slug":"krakend-as-api-gateway-in-minikube-cluster"}},"staticQueryHashes":["4161793270","63159454"]}